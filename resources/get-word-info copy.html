
                <!-- ENGLISH START -->

                <!-- Get HTML from cache or from Wiktionary. -->
                {{ $raw := "" }}
                {{ $html_en := "" }}
                {{ $path_raw := print "assets/html/wiktionary/" $id "_en_raw.html" }}
                {{ else }}
                    <!-- Cache the result. -->
                    {{ with $json.parse  }}
                        {{ $cache := index .text  "*" | resources.FromString (print "wiktionary/" $id "_en_raw.html") | minify }}

                        {{ $raw = $cache.Content }}
                    {{ end }}
                {{ end }}

                <!-- Analyse the German entry in English. -->
                {{ range split $raw "<h2" }}{{ if in . "id=German>" }}

                    {{ $collapsed := false }}
                    {{ range split . "<h3" }}
                        {{ $header := . | replaceRE "\\A.*?>|\\[.*|<div class=\"sister-wikipedia.*?\".*|<span class=mw-headline id=References>.*|<span.*?>|</span>" "" }}

                        {{ if and $header (ne $header "Pronunciation") (ne $header "Further reading") (ne $header "See also") (ne $header "Alternative forms") (ne $header "German") (ne $header "Anagrams") }}

                            <!-- Clean up the html. -->
                            {{ $entry_en := . | replaceRE ".*<\\/h3>| class=\".*?\"| class=[^ >]*|.*</h2>|<span.*?>|</span>|<style.*?</style>|<a .*?>|</a>" "" }}

                            {{ $body := "" }}

                            {{ range split $entry_en "<h4>" }}

                                <!-- Clean up html. -->
                                {{ $mini_body := . | replaceRE ".*<hr>| style=\".*?\"| style=[^ >]*" "" | replaceRE "<h5>(.*?)\\[edit\\]</h5>" "<h6>$1</h6>" | replaceRE "<table.*?>" "<table class=wikitable>" }}

                                {{ if gt (len (findRE "</h4>" .)) 0 }}
                                    <!
                                    {{ $mini_header := . | replaceRE "\\[.*" "" }}

                                    {{ if (ne $mini_header "Declension") }}

                                        <!-- Remove (repeated) header and div's. -->
                                        {{ $mini_body := . | replaceRE ".*</h4>" "" | replaceRE (print "<div[^>]*>" $mini_header "</div>") "" | replaceRE "<div.*?>|</div>|</ul><ul>" "" }}

                                        <!-- Small (or very important) entries are shown right away (non-collapsible). -->
                                        {{ $length := len (replaceRE "<[^>]*>" "" $mini_body) }}
                                        {{ $lines := len (findRE "</li>" $mini_body) }}
                                        {{ if and (lt $length 100) (lt $lines 3) }}
                                            {{ $body = print $body "<div class=\"ui-corner-all custom-corners\"><div class=\"ui-bar ui-bar-a\"><h5>" $mini_header "</h5></div><div class=\"ui-body ui-body-a\">" $mini_body "</div></div>" }}
                                        {{ else }}
                                            {{ $body = print $body "<div data-role=collapsible><h5>" $mini_header "</h5>" $mini_body "</div>" }}
                                        {{ end }}
                                    {{ end }}
                                {{ else }}
                                    <!-- Clean html by removing div's. -->
                                    {{ $mini_body := . | replaceRE "<div.*?>|</div>" "" }}

                                    {{ $body = print $body $mini_body }}
                                {{ end }}
                            {{ end }}

                            <!-- Small (or very important) entries are shown right away (non-collapsible). -->
                            {{ $length := len (replaceRE "<[^>]*>" "" $body) }}
                            {{ $lines := len (findRE "</li>" $body) }}
                            {{ if and (lt $length 100) (lt $lines 3) }}
                                {{ $html_en = print $html_en "<div class=\"ui-corner-all custom-corners\"><div class=\"ui-bar ui-bar-a\"><h4>" $header "</h4></div><div class=\"ui-body ui-body-a\">" $body "</div></div>" }}
                            {{ else }}
                                {{ $collapsed := or $collapsed (eq $header "Etymology")}}
                                {{ $html_en = print $html_en "<div data-role=collapsible data-collapsed=" $collapsed "><h4>" $header "</h4>" $body "</div>" }}
                                {{ if not $collapsed }}
                                    {{ $collapsed = true }}
                                {{ end }}
                            {{ end }}

                        {{ end }}
                    {{ end }}

                {{ end }}{{ end }}

                {{ with $html_en }}
                    {{ $html = print $html "<div data-role=collapsible data-collapsed=false lang=en class=\"en trans\"><h3>English Entry</h3>" $html_en "</div>"}}
                {{ end }}

            {{ end }}<!-- end of: if eq $num_wc 1 -->
            <!-- ENGLISH STOP -->

<!-- STYLE -->

            <!-- Wrap the image and/or table in a div. -->
            {{ if or $html_image $html_table }}
                {{ $html_wc = print $html_wc "<div class=\"non-text\">" $html_image $html_table "</div>" }}
            {{ end }}
            <!-- Correct false plurals. -->
            {{ $lines := len (findRE "</dd>" $body) }}
            {{ if lt $lines 2 }}
                {{ $header = index $data.singulars $header | default $header }}
            {{ end }}
            <!-- If there is audio in the body, play the first one when clicking on the header. -->
            {{ if in $header "Aussprache" }}
                {{ with index (findRE "audio=([^ >]*)>" $body) 0 }}
                    {{ $header = replaceRE "<h4>(.*?)</h4>" (print "<h4 audio=" (replaceRE "audio=|>" "" .) " class=audio-available>$1</h4>") $header }}
                {{ end }}
            {{ end }}

            <!-- Small (or very important) entries are shown right away (non-collapsible). -->
            {{ $length := len (replaceRE "<[^>]*>" "" $body) }}
            {{ if or (and (lt $length 100) (lt $lines 3)) (in $header "Grammatische Merkmale")}}
                {{ $html_item = print "<div class=\"ui-corner-all custom-corners\"><div class=\"ui-bar ui-bar-a\">" $header "</div><div class=\"ui-body ui-body-a\">" $body "</div></div>" }}
            {{ else }}
                {{ $html_item = print "<div data-role=collapsible>" $header $body "</div>" }}
            {{ end }}

            <!-- Wrap in collapsible div. -->
            {{ $html = print $html "<div data-role=collapsible" }}
            {{ if eq $num_wc 1 }}
                <!-- Expand the first. -->
                {{ $html = print $html " data-collapsed=false" }}
            {{ end }}
            {{ $html = print $html "><h3>" $html_wc_name "</h3>" $html_wc "</div>" }}

            <!-- Make breaks instead of semicolons. -->
            {{ $translation = $translation | replaceRE "; " "<br>" }}
            <!-- Add the word as a big header before the first entry. -->
            {{ $html = print $html "<h2><span lang=de class=de>" $article $word "</span><br><span lang=en class=\"en trans\">" $trans "</span></h2>" }}


